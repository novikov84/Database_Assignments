# Курс "Системы хранения и обработки данных"

## Домашнее задание 3. Оконные функции

## Пункты задания:

### Создать таблицы со следующими структурами и загрузить данные из csv-файлов. 

![Transaction datatypes](transaction.png)

![Customer datatypes](customer.png)

Все скрипты для выполнения последующих заданий есть в файле [script.sql](script.sql)
Проверка данных (первый несколько запросов [script.sql](script.sql)) показала, что есть проблема с customer_id 5034, его нет в таблице customer, а в transaction для него есть три транзакции. Потенциально эти транзакции можно удалить (например, как это было сделано в первом домашнем задании), но на результат отработки запросов это не повлияло. 

### Вывести распределение (количество) клиентов по сферам деятельности, отсортировав результат по убыванию количества.
![Question 1](1.png)

### Найти сумму транзакций за каждый месяц по сферам деятельности, отсортировав по месяцам и по сфере деятельности. 
![Question 2](2.png)

### Вывести количество онлайн-заказов для всех брендов в рамках подтвержденных заказов клиентов из сферы IT. 
![Question 3](3.png)

### Найти по всем клиентам сумму всех транзакций (list_price), максимум, минимум и количество транзакций, отсортировав результат по убыванию суммы транзакций и количества транзакций. Выполните двумя способами: используя только group by и используя только оконные функции. Сравните результат.
![Question 4a](4a.png)
![Question 4b](4b.png)

Разница очевидна - в случае использовани оконных функций можно вывести все транзакции для каждого клиента, одновременно добавив результаты оконных функций


### Найти имена и фамилии клиентов с минимальной/максимальной суммой транзакций за весь период (сумма транзакций не может быть null). Напишите отдельные запросы для минимальной и максимальной суммы. 
Для максимальной суммы:
![Question 5 max](5a.png)

Для минимальной суммы (для разнообразия выведем пять, можно уменьшить поменяв лимит):
![Question 5 min](5b.png)

### Вывести только самые первые транзакции клиентов. Решить с помощью оконных функций.
![Question 6](6.png)

### Вывести имена, фамилии и профессии клиентов, между транзакциями которых был максимальный интервал (интервал вычисляется в днях)
![Question 7](7.png)

